

\chapter{Perturbative Approach in Strong Lensing}
\section{\label{sec:BasicIdeas} Basic Ideas}


Let us assume that the two-dimensional projected density $\Sigma$ of a
strong gravitational lens system is axially symmetric and centered at
the origin. Let us assume that the lens is dense enough and that the
distances among the observer, lens, and soruce are such that the
critical density is reached within a radius $\re$. Under such an
hypothesis, the image of a point source placed in the source plane at
the origin will be a perfect ring at $\re$. However, if the source is
not perfectly at the center, or the potential is not perfectly
axisymmetric, the perfect ring is broken into arcs.

To investigate this fact, we will use the lens equation $\vec{r}_s =
\vec{r} - \vec{\alpha}$, where $\vec{r}_s$ is the angular position of
the point source in the source plane (see fig. 5 in \cite{NarayanAndB}
for this configuration), $\vec{r} = r \hat{r} $ is the angular
position of the point source in the image plane, and $\vec{\alpha}$ is
the deflection angle, which is equal to the gradient of the 2D
projected lens potential $\phi$ in the image plane, which in polar coordinates
is

\beq
\vec{\alpha} = \nabla_r \phi = \dfrac{\prtl  \phi}{\prtl r} \hat{r} +
\dfrac{1}{r} \dfrac{\prtl  \phi}{\prtl \theta} \hat{\theta}.
\eeq

(also, we use $ \hat{r}, \hat{\theta}$ in place of Alard's $\hat{u}_r,
\hat{u}_\theta$).

Thus
\bea
\vec{r}_s & = & r \hat{r} - \left( \dfrac{\prtl  \phi}{\prtl r} \hat{r} + {1
\over r} \dfrac{\prtl  \phi }{ \prtl \theta} \hat{\theta} \right) \label{eq:rs}
\\
& = & \left( r -  \dfrac{\prtl \phi}{\prtl r} \right) \hat{r} -  \dfrac{1}{r}
\dfrac{\prtl \phi }{\prtl \theta} \hat{\theta}
\eea

Now let us go to the simplest case of an on-axis point source with
perfectly axially symmetric potential $\phi(\vec{r}) = \phi_0(|\vec{r}|)$.  In
this case
$r_s = 0$ and  ${\prtl \phi_0 \over \prtl \theta} = 0$ since there is no
angular variation of the potential.

Thus, eq.(\ref{eq:rs}) reduces to

\beq
0 =  r -  {\prtl  \phi \over \prtl r}
\eeq

the solution to which is the Einstein Radius

\beq
\label{eq:einsteinradius}
  \re =  \left. {\prtl  \phi \over \prtl r} \right|_{\re} 
\eeq

where the derivative of the potential is to be evaluated at the Einstein radius,
$ \re$.

This indicates the point source is spread into a circle of radius $ \re $ in the
image plane.

We now take the first step of perturbing the situation:

\bea
\label{eq:rspert}
\vec{r}_s & = & \eps \vec{y}, \\
\phi( \vec{r} ) & = & \phi_0(|\vec{r}|) + \eps \psi( \vec{r} )
\label{eq:potsplit},
\eea

which imply we have moved the source off-axis, and added a non-axially
symmetric potential, both to the exact same order $\eps$ by
assumption.  Note that the perturbed distance $y$ is in the source plane.

Note that this changes the notation of the first eq in Alard eq.~3
(which doesn't make much sense, of course).

We now write the image position also as a perturbation around the
Einstein Radius, using eq.(\ref{eq:rspert}) to modify
eq.(\ref{eq:einsteinradius}) into

\beq
\label{eq:rpert}
r = \re +  \eps x
\eeq

which changes the notation in Alard eq.~4 (which is somewhat weird notation,
since his $dr$ is not necessarily a small distance), and we do not follow
his convention of setting $\re \equiv 1$.

Note that now the perturbed distance $x$ is in the image plane.

To recap: $r_s, y$ are in the source plane, while $r, x$ are in the image plane.

Now we do a Taylor series expansion of the potential about the Einstein ring
radius:

\beq
\phi = \phi_0 + \eps \psi = \sum_{n=0}^\infty {1 \over n!} \left. {d^n \phi_0
\over dr^n }\right|_{\re} (r-\re)^n + \eps {1 \over n!} \left. {d^n \psi \over
dr^n }\right|_{\re} (r-\re)^n
\eeq

or

\beq
\label{eq:tse}
\phi  = \sum_{n=0}^\infty \left[ {1 \over n!} \left. {d^n \phi_0 \over dr^n
}\right|_{\re} + \eps {1 \over n!} \left. {d^n \psi \over dr^n }\right|_{\re}
\right] (r-\re)^n
\eeq

And now define

\beq
\label{eq:Cndef}
C_n \equiv {1 \over n!} \left. {d^n \phi_0 \over dr^n }\right|_{\re}
\eeq

\beq
\label{eq:fndef}
f_n(\theta) \equiv  {1 \over n!} \left. {d^n \psi \over dr^n }\right|_{\re}
\eeq

So that we can write  eq.(\ref{eq:tse}) as

\beq
\label{eq:tse2}
\phi  = \sum_{n=0}^\infty \left[ C_n + \eps f_n(\theta)  \right] (r-\re)^n
\eeq

where $f_n(\theta)$ is a one-dimensional function independent of $r$.


Now we go back and substitute \eqref{eq:rspert}) and \eqref{eq:rpert}) into
\eqref{eq:rs}) to find
\beq
\eps y = \left( \re + \eps x -  {\prtl  \phi \over \prtl r} \right) \hat{r} - {1
\over \re + \eps x}  {\prtl  \phi \over \prtl \theta} \hat{\theta}
\eeq

Now substitute \eqref{eq:tse2}) into this to find

\bea
\eps \vec{y} = \left( \re + \eps x -  {\prtl \over \prtl r} \left(
\sum_{n=0}^\infty \left[ C_n + \eps f_n  \right] (r-\re)^n  \right) \right)
\hat{r} - \\
{1 \over \re + \eps x}  {\prtl  \over \prtl \theta} \left( \sum_{n=0}^\infty
\left[ C_n + \eps f_n  \right] (r-\re)^n  \right)  \hat{\theta} \nonumber
\eea

Remembering that $C_n$ and  $f_n$ are independent of $r$, and using
\eqref{eq:rpert}), $r-\re = \eps x$ we find

\bea
\label{eq:tse3}
\eps y = \left( \re + \eps x -   \sum_{n=0}^\infty \left[ C_n + \eps f_n 
\right] n (\eps x)^{n-1}  \right) \hat{r} - \\
{1 \over \re + \eps x}  {\prtl  \over \prtl \theta} \left( \sum_{n=0}^\infty
\left[ C_n + \eps f_n  \right] (\eps x)^n  \right)  \hat{\theta} \nonumber
\eea

Let us expand \eqref{eq:tse3} in orders, first the zero'th order piece in
$\eps$:

\beq
0 =  \left(\re - C_1 \right) \hat{r} \rightarrow \re = C_1 = \left. \prtl \phi
\over \prtl \theta \right|_{\re},
\eeq

so that we reassuringly recover the Einstein ring solution.

Next the first order piece in $\eps$:

\beq
\eps \vec{y} = \left( \eps x - (2 C_2 \eps x + \eps f_1 ) \right) \hat{r} - {1
\over \re} \eps {\prtl f_0 \over \prtl \theta } \hat{\theta}
\eeq

where the coefficient of $C_2$ was expanded to order $n=2$, that of
the $f_1$ term to order $n=1$, and that of the $\prtl f_1 \over \prtl
\theta$ term ro order $n=0$.  

%Bit involved, but this is how to get each term proportional to $\eps$.

%Now we will return to the ``physical variables'' $\eps \vec{y} = \vec{r}_s,
%\eps x = \Delta r

Now divide through by $\eps$ and collect terms:

\beq
 \vecy = \left[ (1-2 C_2) x -  f_1 \right] \hat{r} - {1 \over \re} {\prtl f_0
\over \prtl \te} \hat{\theta}
\eeq

or, defining $\kt = 1-2 C_2$

\beq
\label{eq:rsexpanded}
\vecy = ( \kt x - f_1 ) \hat{r} - {1 \over \re} {\prtl f_0 \over \prtl \te} 
\hat{\theta}
\eeq

which is Alard eq.8 (remember he set $\re \equiv 1$).


\section{Conditions for the Validity of the Approximation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Habib

At first order in $\eps$ we may define

\begin{equation}
 q \equiv \frac{r}{\re}[1-\eps\,g(\te)].
\end{equation}

As the functional $\phi_0(q)$ represents the general expression
for the perturbed potential, with $q$ defined above, we may expand $\phi_0(q)$

\begin{displaymath}
 \phi_0(q)=\phi_0\left(\rre-\eps\rre\,g(\te)\right)
\end{displaymath}

\noindent in a Taylor Series around $\eps=0$, in the following way

\def\dpdq{ \left. \left( \frac{d\phi_0}{dq}\right) \right|_{\eps=0} }
\def\dpde{ \left. \left( \frac{d\phi_0}{d\eps}\right) \right|_{\eps=0} }

\begin{eqnarray}
 \phi_0(q) &\approx& \phi_0\prre+\eps \dpde \\
	  & = & \phi\prre+\eps \dpdq  \left(\frac{\prtl q}{\prtl \eps}\right)\\
	  &\approx& \phi\prre-\rre\phi_0^\prime\prre g(\te)\eps \label{key1}
\end{eqnarray}

Where we have defined $\phi_0^\prime\prre \equiv  \dpdq$.  Note, that we have
$\phi_0(q)=\phi_0\prre$ when $\eps=0$ and similarly with its derivatives.
Therefore,
taking the partial derivatives of Eq.~(\ref{key1}), it is straightforward to
verify

\begin{eqnarray}
 \re\frac{\prtl \phi}{\prtl r}&=& \phi_0^\prime\prre -%
  \eps\left[g(\te)\phi_0^\prime\prre+\rre g(\te)\phi_0^{\prime
\prime}\prre\right]\\
\frac{\re}{r}\frac{\prtl \phi}{\prtl \te}&=&-\phi_0^\prime\prre
\frac{dg(\te)}{d\te}\eps
\end{eqnarray}

(Alard eq.19).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Critical Curves, Caustic Lines and Deformation Cross-Section in the
Perturbative Approach}

[{\bf Include an introduction discussing the importance of source-independent
``observables''}]

\subsection{The Jacobian Matrix of the transformation}

In order to obtain the equations for the critical curves, caustics and the area
of the deformation cross-section, we'll need to make coordinate transformations
between the two planes, {\it bearing in mind that there may also be coordinate
transformations involved in the process}.

More specifically, suppose that we're using the perturbed Lens Equation to pass
from the lens plane to the source plane, both in Cartesian coordinates. This
transformation is given by the Jacobian Matrix $J_{L_C\rightarrow S_C}$.
However, in the perturbative approach, a lot of the quantities are more
conveniently written in terms of polar coordinates. In the next sections, we'll
make use of the following three facts:
\bea
J_{L_C\rightarrow S_C}&=&J_{L_P\rightarrow
S_C}J_{L_C\rightarrow L_P}\label{jacobian_comp}\\
\det(AB)&=&\det A\det B\label{determinant_mult}\\
\mbox{tr}\,(AB)&=&A_{11}B_{11}+A_{12}B_{21}+A_{21}B_{12}+A_{22}B_{22}\,,\mbox{
for $2\times 2$ matrices}\label{trace}
\eea
We also recall that the components of $J_{L_C\rightarrow L_P}$ are given by:
\begin{eqnarray}
\frac{\prtl r}{\prtl x_1}&=&\cos{\te}\label{drdx1}   \\
\frac{\prtl \te}{\prtl x_1}&=&-\frac{\sin{\te}}{r}\label{dtedx1}\\
\frac{\prtl r}{\prtl x_2}&=&\sin{\te}\label{drdx2}\\
\frac{\prtl \te}{\prtl x_2}&=&-\frac{\cos{\te}}{r}\label{dte2dx2}
\end{eqnarray}

\subsection{Critical Curves and Caustics}

We will now obtain the equations for the critical curves in the lens
plane, which correspond to the caustic curves in the source plane.

First write \eqref{eq:rsexpanded}) in Cartesian coordinates (writing
the unit polar vectors as \eqref{eq:unitvs}), and taking
$\vec{y}=(y_1,y_2)$ in the source plane and $\vec{r}=(r,\te)$ in the
lens plane:
%Note that as we have not considered the position of the source,
%we have $\bar{f}_i=f_i$ and therefore
\begin{eqnarray}
y_{1} &=& (\kt x - f_1)\cos{\te}+\frac{1}{\re}\frac{d f_0}{d\te}\sin{\te}
\label{y_1}\\
y_{2} &=& (\kt x - f_1)\sin{\te}-\frac{1}{\re}\frac{d f_0}{d\te}\sin{\te}
\label{y_2},
\end{eqnarray}

It is important to stress that even though $y_{1}$ and $y_{2}$ are written in
terms of $r$ and $\te$, equations (\ref{y_1}) and (\ref{y_2}) describe the
transformation $J_{L_C\rightarrow S_C}$. Let us decompose it following eq.
(\ref{jacobian_comp}). The components of the Jacobian matrix $J_{L_P\rightarrow
S_C}$ are given by %polar to Cartesian coordinates

%\begin{equation}
%J=\frac{\prtl y_1}{\prtl r}\frac{\prtl y_2}{\prtl \te}-\frac{\prtl y_1}{\prtl
%\te}\frac{\prtl y_2}{\prtl r}.
%\label{jacob}
%\end{equation}

%The critical lines are defined by the condition $J=0$. 
\begin{eqnarray}
\frac{\prtl y_1}{\prtl r}&=& \kt \cos{\te}\label{dy1dx}   \\
\frac{\prtl y_2}{\prtl r}&=& \kt \sin{\te}\\
\frac{\prtl y_1}{\prtl \te}&=& \scriptf(\te)\sin{\te}+\scriptg(\te)\cos{\te}\\
\frac{\prtl y_2}{\prtl \te}&=&
-\scriptf(\te)\cos{\te}+\scriptg(\te)\sin{\te}\label{dy2dte}
\end{eqnarray}

using \eqref{eq:rsexpanded}), ${\prtl \over \prtl r} ={ 1 \over \epsilon}
{\prtl \over \prtl x}$ (from \eqref{eq:rpert}) and defining the functions
$\scriptf$ and $\scriptg$ as

\bea
% \begin{equation}
\scriptf(\te)&=&\frac{1}{\re}\frac{d^2f_0}{d\te^2}-(\kt x -f_1) \quad \\
% \textrm{and} \quad % \\
\scriptg(\te)&=&\frac{1}{\re}\frac{df_0}{d\te}-\frac{df_1}{d\te}
\eea
% \end{equation}

It is straightforward to verify that the determinant of this matrix is given by
$\det \left(J_{L_P\rightarrow S_C}\right)=-\kt\scriptf(\te)$. Knowing that the
Jacobian matrix $J_{L_C\rightarrow L_P}$ is the usual Jacobian transformation
from Cartesian to polar coordinates, with $\det \left(J_{L_C\rightarrow
L_P}\right)=\frac{1}{r}$, we can use eq. (\ref{determinant_mult}) to show that
\beq
J\equiv\det \left(J_{L_C\rightarrow
S_C}\right)=-\frac{\kt\scriptf(\te)}{r}\,.\label{jacobian}
\eeq

Therefore on the critical curves, where $J = 0$, we have

\begin{equation}
\label{eq:critcurves}
\Delta x_{crit}=\frac{1}{\kt}\left[f_1+\frac{1}{\re}\frac{d^2f_0}{d\te^2}\right]
\end{equation}

This is Alard eq.~30. From this last equation, the tangential critical
curve can be expressed in Cartesian coordinates in parametric form as 
\beq
\vec{r}_{\mathrm{crit}}= \left[(\re  +\Delta x_{crit})\cos{\te},(\re+\Delta x_{crit})\sin{\te}\right],\quad
0 \leq \te < 2\pi.  
\eeq

Now, substituting this last equation into eqs.~(\ref{y_1}) and
(\ref{y_2}) we obtain, the parametric equation for the tangential
caustic, i.e.,

\begin{eqnarray}
\label{eq:xcaustic}
y_{1_\mathrm{caust}} &=&
\frac{1}{\re}\frac{d^2f_0}{d\te^2}\cos{\te}+\frac{1}{\re}\frac{df_0}{d\te}\sin{
\te}\\
\label{eq:ycaustic}
y_{2_\mathrm{caust}} &=&
\frac{1}{\re}\frac{d^2f_0}{d\te^2}\sin{\te}-\frac{1}{\re}\frac{df_0}{d\te}\cos{
\te}
\end{eqnarray}

Which reduce to Alard's eqs.~31 for $\re=0$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  From before

Getting Alard eq.33 from the above is straight, and from there we may obtain
% I (MSSG) got most of the way to 
Alard eq.34 from 33 and 32.
% with some small hiccups..
\subsection{Eigenvalues of the Jacobian Matrix and Deformation Cross-Section}

To obtain the deformation cross-section, we want to obtain a
non-parametric expression $r_\pm (\te)$ for the limiting curves of this area. To
begin with, we recall that the eigenvalues of a $2\times 2$ non-singular matrix
$M$
are given by
\beq
\lambda_\pm=\frac{1}{2}\left(\mbox{tr}\, M\pm\sqrt{(\mbox{tr}\,M)^2-4\det
M}\right)\label{eigenvalues}
\eeq 
where $\mbox{tr}\, M$ is the trace of the matrix $M$. Using eqs. \ref{jacobian}
and \ref{trace}, it is possible to show that the eigenvalues of $J_{L_C\rightarrow
S_C}$ are given by
\bea
\lambda_{+}&=&\kt\label{eigenvalue1}\\
\lambda_{-}&=&-\frac{\scriptf(\te)}{r}=-\frac{\scriptf(\te)}{\re+x}\label{eigenvalue2}
\eea


%Therefore
%\beq
%\frac{\lambda_+}{\lambda_-}=\frac{1+\tau\sqrt{1-\alpha}}{1-\tau\sqrt{1-\alpha}}
%\label{eigenvalues_division}
%\eeq
%with $\tau=\mbox{sgn}\, M$ and $\alpha=4\frac{\det M}{(\mbox{tr}\,M)^2}$. 
If we set $\left|\frac{\lambda_+}{\lambda_-}\right|=N$ (a condition that will be used to define the
cross-section), then we can solve for the radius of the frontiers of the deformation cross-section area. The solutions are
\bea
r_{+}(\te)&=&\left|\vec{r}_{\mathrm{crit}}\right|\left(1+\frac{1}{1-N}\right)\label{rmax}\\
r_{-}(\te)&=&\left|\vec{r}_{\mathrm{crit}}\right|\left(1-\frac{1}{1-N}\right)\label{rmin}
\eea
%\beq
%\frac{\det M}{(\mbox{tr}\,M)^2}=\frac{N}{(N+1)^2}
%\eeq


\section{Reconstruction of Images}

One advantage of the perturbative approach is that it allows us to
construct an analytic solution for the lensed images of sources
located near the tangential caustic.  In this section we study the
mapping of circular and elliptical contours using this formalism.

\subsection{Circular Sources}

\begin{wrapfigure}{r}{0.4\textwidth}
  \begin{center}
%  \centering{\epsfig{Fig_subsstructure.eps,width=0.45\textwidth}}
   \includegraphics[width=0.35\textwidth]{graphics/sourceplane.pdf}
  \end{center}
    \caption{\label{fig:circular_source}Circular source geometry in the source
plane.}
\end{wrapfigure}

Notation: $ \vec{r}_{0}$ points from the origin (i.e center of the
source plane, which is the point we see looking directly on-axis from
us through the lens to the source) to the center of the actual source
object (which might be e.g a small face-on spiral galaxy), $
\vec{R}_{0}$ is the vectorial radius of this source from its center,
and $ \vec{r}_{s}$ is the vector from the origin to some point on the
edge of the circular source. See Fig.~\ref{fig:circular_source} for this
configuration.



Thus we have

\bea
\vec{r}_s &=&  \vec{r}_{0} + \vec{R}_{0} \\
  \vec{R}_{0} &=& \vec{r}_s - \vec{r}_{0}. \nonumber
\eea


Replacing $r_s$ by eq.~\eqref{eq:rsexpanded}, we obtain:

\beq
\label{eq:Rzero}
\vec{R_{0}} = \left[ \kappa_2 x - f_{1}(\theta) \right]\hat{r} - \frac{1}{\re}
\frac{\partial f_0(\theta)}{\partial \theta} \hat{\theta} - \vec{r_{0}}. \;\;\;
\eeq


Note that $\vec{r}_{0} = (\yone,\ytwo)$ lies in the source plane, but we
can write it in terms of the polar unit vectors

\bea
\label{eq:unitvs}
\hat{r}=(\cos\te, \sin \te) \\
\hat{\theta}=(-\sin \te, \cos \te)
\eea

 as following

\beq
\vecrz = (\vecrz \cdot \hatth) \hatth + (\vecrz \cdot \hatr) \hatr
\eeq

or


\beq
\label{eq:rzero}
\vec{r}_{0} = \left[ \yone \,  \cos \te + \ytwo \,  \sin \te \right] \hat{r} +
\left[ -\yone \,  \sin \te + \ytwo \,  \cos \te \right] \hat{\theta}.  \;\;\;
\eeq

So that eq.~\eqref{eq:Rzero} becomes

\beq
\vec{R_{0}} = \left[ \kappa_2 x - f_{1}(\theta) \right]\hat{r} - \frac{1}{\re}
\frac{\partial f_0(\theta)}{\partial \theta} \hat{\theta} -  \left[ \yone \, 
\cos \te + \ytwo \,  \sin \te \right] \hat{r} - \left[ -\yone \,  \sin \te +
\ytwo \,  \cos \te \right] \hat{\theta} \;\;\;
\eeq


Defining

\beq
\overline{f}_i(\theta) \equiv f_i(\theta) + (\yone \cos \te + \ytwo \sin
\te)\re^{1-i}, \;\; i=0,1
\eeq

this becomes

\beq
\vec{R}_{0} = \left[ \kappa_2 x - \overline{f}_{1}(\theta) \right]\hat{r} -
\frac{1}{\re} \frac{\partial \overline{f}_0(\theta)}{\partial \theta}
\hat{\theta}. \;\;\; \label{eq:Alard11}
\eeq

(Alard eq.11).

Now, taking the square of this we obtain

\beq
R_{0}^2 = \left[ \kappa_2 x - \overline{f}_{1}(\theta) \right]^2 +
\left[\frac{1}{\re} \frac{\partial \overline{f}_0(\theta)}{\partial
\theta}\right]^2. \;\;\;
\eeq

Solving this for $x(\te)$, the radius of the arc in the image plane as
a function of theta, the following two solutions are obtained:

\beq
\label{eq:xsoln}
x = \frac{1}{\kappa_2}\left[ \overline{f}_{1}(\theta) \pm \sqrt{R_0^2 - \left(
\frac{1}{\re}\frac{\partial \overline{f}_0(\theta)}{\partial \theta} \right)^2}
\right]. \;\;\;
\eeq

the negative and positive solutions corresponding to the inner and outer edges
of the arc.

Thus, given the source radius $R_{0}$ and position $(x_0,y_0)$ we can
draw the arcs using eq.~\eqref{eq:xsoln}). The parametric equation for the
arcs images is given by

\beq
\label{eq:parametricarcs}
\vec{r}= \left[(\re +x)\cos{\te},(\re+x)\sin{\te}\right], \quad 0 \leq \te <
2\pi.
\eeq


\subsection{Elliptical Source Contours with Aligned Axes}
%%%%%%%%%%%%%%%%%%% Gabriel
% {\bf If someone have doubts about this procedure, let me know \ldots}

We now extend the discussion of the previous section to elliptical
source contours.

First we consider the vectorial equation of an elliptical source
aligned along the major axis of the potential (note that this is a
very limited set of ellipses),

\beq
\label{eq:ellipse}
\vec{R}_0=\left(\sqrt{1-\eta_s} \, y_{1s},\sqrt{1+\eta_s} \, y_{2s}\right)
\eeq

where $\eta_s$ is the ellipticity of the source, $R_0$ is the vector from the
center to the edge of the source

% characteristic size of the source
and
 
\bea
y_{1s} &=& (\vec{r}_s-\vec{r}_0)\cdot\hat{i}, \\
y_{2s} &=& (\vec{r}_s-\vec{r}_0)\cdot\hat{j}
\eea

From eq.~(\ref{eq:Alard11}) and writing the polar unit vectors in Cartesian
components we obtain

\bea
y_{1s}&=&(\kt x -\bar{f}_1)\cos{\te}+\frac{1}{\re}\dfrac{\prtl \bar{f}_0}{\prtl
\te}\sin{\te} \label{y_1s}\\
y_{2s}&=&(\kt x -\bar{f}_1)\sin{\te}-\frac{1}{\re}\dfrac{\prtl \bar{f}_0}{\prtl
\te}\cos{\te} \label{y_2s}.
\eea

Defining

\bea
\bar{y}_{1s}&=&\kt x -\bar{f}_1\label{bar_y1}\\
\bar{y}_{2s}&=&\frac{1}{\re}\dfrac{\prtl \bar{f}_0}{\prtl \te},\label{bar_y2}
\eea
we may express $\vec{R}_0$ as

\beq
\vec{R}_0=\left[\sqrt{1-\eta_s}(\bar{y}_{1s}\cos{\te}+\bar{y}_{2s}\sin{\te})
\right]\hat{\imath}+\left[\sqrt{1+\eta_s}(\bar{y}_{1s}\sin{\te}-\bar{y}_{2s}\cos
{\te}) \right]\hat{\jmath}
\eeq

Taking the square of the equation above and solving for $\bar{y}_{1s}$, it is
straightforward to verify

\beq
\bar{y}_{1s}=\dfrac{\eta_s\cos{(2\te)}}{S}\bar{y}_{2s}\pm \frac{1}{S}\sqrt{S
R_0^2-(1-\eta_s)\bar{y}^2_{2s}}
\eeq

where $S=1-\eta_s\cos{(2\te)}$. Substituting eq.~\eqref{bar_y1} and
eq.~\eqref{bar_y2} into the equation above, we obtain

\beq
x = \frac{1}{\kappa_2} \left\{\bar{f}_{1}(\theta) +
\frac{\eta_s\sin(2\theta)}{S}\left(\frac{1}{\re}\dfrac{\partial
\bar{f}_0(\theta)}{\partial \theta}\right) \pm \frac{1}{S}\sqrt{SR_{0}^2 -
(1-\eta_s^2)\left[ \frac{1}{\re}\frac{\partial \bar{f}_0(\theta)}{\partial
\theta}\right]^2}  \right\}.
\label{elliptical_contour}
\eeq

The parametric equation now for the images of elliptical sources of this form is

\beq
\vec{r}= \left[(\re +x)\cos{\te},(\re+x)\sin{\te}\right], \quad 0 \leq \te <
2\pi.
\eeq


\subsection{Elliptical Source Contours in the General Case (Nonaligned Axes)}

In the general case, when the source is not aligned to the semimajor axis of the
potential, the vectorial equation of an elliptical contour is

\beq
\label{eq:ellipsetheta}
\vec{R}_0=\left(\sqrt{1-\eta_s} \, y^\prime_{1s},\sqrt{1+\eta_s} \,
y^\prime_{2s}\right)
\eeq
where the source is oriented at an angle
$\te_0$ \wrt\ the  semimajor axis,  and $y^\prime_{is}\, (i=1,2)$ are obtained
by rotating the coordinate system of the source by an angle $\te_0$,
i.e
\begin{equation}
\left(\begin{array}{c}y^\prime_{1s} \\ y^\prime_{2s}
\end{array}\right)=\left[\begin{array}{c c}%
\cos{\te_0} & \sin{\te_0}\\ -\sin{\te_0} & \cos{\te_0} \end{array} \right]\left(
\begin{array}{c} y_{1s}\\ y_{2s}\end{array}\right)
\end{equation}

Using eqs.~(\ref{y_1s}-\ref{bar_y2}) it is straightforward to verify
\bea
y^\prime_{1s}&=&\bar{y}_1\cos{\tilde{\te}}+\bar{y}_2\sin{\tilde{\te}}\\
y^\prime_{2s}&=&\bar{y}_1\sin{\tilde{\te}}-\bar{y}_2\cos{\tilde{\te}}\\
\tilde{\te}&\equiv&\te-\te_0
\eea

Now, following the procedure shown above, is straightforward to obtain the
expression for the images coming from
lensed elliptical sources (with orientation $\te_0$).  It is given by the
Eq.(\ref{elliptical_contour}) with $\te$ replaced by $\tilde{\te}$, i.e.

\bea
\label{eq:ellipsource}
x &=& \frac{1}{\kappa_2} \left\{\bar{f}_{1}(\theta) +%
\frac{\eta_s\sin(2\tilde{\theta})}{S}\left(\frac{1}{\re}\dfrac{\partial%
\bar{f}_0(\theta)}{\partial \theta}\right) \pm \frac{1}{S}\sqrt{SR_{0}^2 -%
(1-\eta_s^2)\left[ \frac{1}{\re}\frac{\partial \bar{f}_0(\theta)}{\partial
\theta}\right]^2}  \right\}.\label{elliptical_contour2}\\
S&\equiv& 1-\eta_s\cos{(2\tilde{\te})}\nonumber
\eea
This is the eq.~(28) of Peirani et al. 2008 (recall again, they set $\re=1$ and
$\eta_s=\sqrt{2\eta_0}$)

%\beq
%\label{eq:ellipse}
%(1-\eta_s)x_s^2 + (1+\eta_s)y_s^2 = R_{0}^2.\;\;\;
%\eeq

As we can see, the condition for the formation of images is given by
\begin{equation*}
S\,R^2_0>(1-\eta^2_s)\left[\frac{1}{\re}\dfrac{\prtl \bar{f}_0}{\prtl
\te}\right]^2
\end{equation*}

And therefore, the number of images is given by the quantity of times
in the range $\theta = 0 $ to $2 \pi$ that the expression of the
radicand in \eqref{elliptical_contour2}) switches sign, divided by
two.


\section{Measurements of the arc properties}

One of the great advantages of the Perturbative Method is that it
allows us to calculate the analytical expressions for the images contours
coming from lensed sources.

\begin{figure*}[!htp]
\resizebox{\hsize}{!}{
\subfigure{\includegraphics{graphics/measure_arc2.png}}
\hspace{3.cm}
\subfigure{\includegraphics{graphics/measure_arc_w.pdf}}}
\caption{\label{measure_arcs} Method used to measure the length
and width of the images. Left Panel: Schematic representation for the
measurement of the length. Right Panel: Schematic representation for the
measurement of the width}
\end{figure*}


Following P.~Ferreira's ideas, shown in \cite{pedrothesis}, we will now
provide expressions for the measurements of the Length, Width and area
of the arc-images. Basically, Ferreira shows three methods for
measuring the length of the arcs, denoted $L_1$, $L_2$ and $L_3$, and
two methods for measure the width of the arcs, denoted $W$ and $W_q$.
The first method is overly simplistic and will not be considered in
this report, except to introduce the geometry of the arcs. We will
adapt the second and third methods in the framework of the
Perturbative Method and also to propose a method similar to C.~De Bom's
Method \cite{clecio} to measure the length.


In the Perturbative Method, the inner and outer radial vector of an arc
are given by

\bea
\vec{r}_{+}&=&(\re + x_{+})\cos{\te}\hat{\imath}+(\re
+x_{+})\sin{\te}\hat{\jmath}\label{rplus}\\
\vec{r}_{-}&=&(\re + x_{-})\cos{\te}\hat{\imath}+(\re
+x_{-})\sin{\te}\hat{\jmath}\label{rminus}
\eea
where $x_{\pm}$ are given by eq.~(\ref{elliptical_contour2}) for an
elliptical source oriented in any direction with respect to the source
potential semimajor axis.  Therefore, we may define a mean value of
the radial coordinate at a given angle $\te$ as

\bea
\bar{r}(\te)&=&\dfrac{r_{+}+r_{-}}{2}=\re+\left(\dfrac{x_{+}+x_{-}}{2}
\right) \nonumber \\
       &=& \re +\dfrac{1}{\kt}\left\{ \bar{f}_{1}(\theta) +%
\frac{\eta_s\sin(2\tilde{\theta})}{S}\left(\frac{1}{\re}\dfrac{\partial%
\bar{f}_0(\theta)}{\partial \theta}\right) \right\},\label{r_mean}
\eea
and the width as a function of $\te$ is given by 
\beq
W(\te)=x_+ - x_- = \dfrac{2}{\kt\,S}\sqrt{SR_{0}^2 -(1-\eta_s^2)\left[
\frac{1}{\re}\frac{\partial \bar{f}_0(\theta)}{\partial \theta}\right]^2}
\label{w_arc}
\eeq

Another useful quantity is the angle defining the barycenter of the image, given
by
\beq
\te_G={ \te_i+\te_f \over 2}
\label{angle_bary}
\eeq

where $ \te_i , \te_f $ label the beginning and ending angular position of a
given arc.

\subsection{Measurement of the Length}

The first method for arc length measurement, $L_1$, corresponds to the
distance between the points of the extrema of the arc and is
represented by the straight line segment joining the points $P_1$ and
$P_2$ (see Left Panel in Fig.~\ref{measure_arcs}).  By the condition
of the formation of images, we know the angles between which the arc
is formed. We call these angles as $\te_{i}$ and $\te_{f}$, and we
define the points $P_1$, $P_2$ as the mean radial vector at these
angles, i.e,

\beq
P_1=(\bar{r}_i\cos{\te_i},\bar{r}_{i}\sin{\te_i}), \quad
P_2=(\bar{r}_f\cos{\te_f},\bar{r}_{f}\sin{\te_f})
\eeq
where $\bar{r}_i\equiv \bar{r}(\te_i)$ and $\bar{r}_f\equiv \bar{r}(\te_f)$.
Then, the first measure for the length $L_1$ is
\beq
L_1=\sqrt{\bar{r}_i^2+\bar{r}_f^2-2\bar{r}_i\bar{r}_f\cos{(\te_f-\te_i)}}.
\label{first_length_def}
\eeq

This overly simplistic method was only introduced for notational
purposes, and will not be further discussed in this report.

The second method consists of calculating the distance resulting of
the summation of the straight line segments joining the points $P_1$
and $P_G$ ($L_{1G}$) and $P_G$ and $P_2$ ($L_{2G}$). Where the Point
$P_G$ correspond to the barycenter (i.e. gravicenter) of the image,
defined by radial vector at the angle $\te_G$.

\beq
P_G\equiv
(\bar{r}_G,\te_G)=(\bar{r}(\te_G)\cos{\te_G},\bar{r}(\te_G)\sin{\te_G})
\eeq

With the expression above, we have
\bea
L_{1G}&=&\sqrt{\bar{r}_i^2+\bar{r}_G^2-2\bar{r}_i\bar{r}_G\cos{
(\te_G-\te_i) } }\\ 
L_{2G}&=&\sqrt{\bar{r}_f^2+\bar{r}_G^2-2\bar{r}_i\bar{r}_G\cos{(\te_f-\te_G)}}
.\\
L_2&=&L_{1G}+L_{2G}
\eea

The third method consists of obtaining the equation of the circle
passing through three points belonging to the arc. Recall that that
the equation of a circle, with center ($x_{c},y_{c}$) and radius $R_c$
is
\begin{equation*}
 (x-x_c)^2+(y-y_c)^2=R^2_c
\end{equation*}
or
\beq
x^2+y^2+Ax+By+C=0\\
\eeq 

Considering the circular arc that passes through three points $P_1$, $P_G$ and
$P_2$, we need to solve the following system of equations


\begin{equation}
 \left[\begin{array}{c c c}
        \bar{r}_i\cos{\te_i} & \bar{r}_i\sin{\te_i} & 1\\
	\bar{r}_G\cos{\te_G} & \bar{r}_G\sin{\te_G} & 1\\
	\bar{r}_f\cos{\te_f} & \bar{r}_f\sin{\te_f} & 1\\
\end{array} \right]\left(\begin{array}{c} A \\ B\\ C
\end{array}\right)=-\left(\begin{array}{c}                         
\bar{r}^2_i\\ \bar{r}^2_G\\ \bar{r}^2_f\end{array}  \right) 
\end{equation}

where 
\bea
 x_c &=& -\dfrac{A}{2},\quad y_c = -\dfrac{B}{2}\\
 R_c &=&\sqrt{x_c^2+y_c^2-C}. 
\eea

The length of the image is then defined in this method by
\beq
L_3=R_c\arccos{\left(1-\dfrac{L_1^2}{2R_c^2}  \right)}
\eeq
where $L_1$ was given in Eq.~(\ref{first_length_def}).

Another proposal to measure the length yields perhaps a yet more
accurate way of obtaining it.  This method gives the length of a
circular arc segment passing through the points $P_1$ and $P_2$, see
the dashed line at the Left Panel of the Fig.~\ref{measure_arcs}, and
is given by

\beq
L_4=\int_{\te_i}^{\te_f}\bar{r}(\te)d\te.
\eeq

As a particular case, for the elliptical source contours aligned to the main
axis, we can obtain an analytic expression for the length of the arcs. For an
angle $\te$, we define
\beq
\mathcal{L}(\te)=\re\te+\mathcal{L}_s(\te)+\mathcal{L}_{\psi}(\te),
\eeq
where
\bea
\mathcal{L}_s&=&\frac{1}{\kt}\sqrt{\dfrac{1-\eta_s}{2\eta_s}}\left\{%
x_0\tan^{-1}{\left[\dfrac{\sqrt{2\eta_s}\sin{\te}}{\sqrt{1-\eta_s}}\right]}-%
y_0\tanh^{-1}{\left[\dfrac{\sqrt{2\eta_s}\cos{\te}}{\sqrt{1+\eta_s}}\right]}
\right\}\label{L_s}\\
\mathcal{L}_{\psi}&=&\frac{1}{\kt}\int\left\{f_{1}(\theta) +%
\frac{\eta_s\sin(2\theta)}{S}\left(\frac{1}{\re}\dfrac{\partial%
f_0(\theta)}{\partial \theta}\right)\right\} \label{L_psi}.
\eea



Then, using the expressions above we have
$L_4=\mathcal{L}(\te_f)-\mathcal{L}(\te_i)$.


Note, that for a circular source, $\mathcal{L}_s$ becomes

\beq
\mathcal{L}_s=\frac{x_0}{\kt}\sin{\te}-\frac{y_0}{\kt}\cos{\te}.
\eeq

\subsection{Measurement of the Width}

The first method to obtain the width of the arcs, is to measure the width 
at the angle $\te_G$, i.e, $W_q \equiv W(\te_m)$, using \eqref{w_arc}).


The second method consists of using the area of the image. This area is given by
\bea
\mathcal{A}&=&\int_{\te_i}^{\te_f}\int_{r_{-}(\te)}^{r_{+}(\te)}r \, dr \, d\te
\nonumber\\
           &=&\int_{\te_i}^{\te_f}W(\te)\bar{r}(\te)d\te.
\eea
where, $\bar{r}(\te)$ and $W(\te)$ are given by the Eqs. (\ref{r_mean}) and
(\ref{w_arc}) respectively.

Now we assume that the area of an arc is exactly that of a distorted
ellipse. With this assumption, the width of an arcs is given by
\beq
W_k=\dfrac{4\mathcal{A}}{\pi L_k}
\eeq
where $L_k$ corresponds to the one of the methods of measuring the length of the
arcs, $k=2,3$ or
$4$. 


\section{Inverse Modelling}

The perturbative method has the advantage of offering a linear non-parametric
approach for gravitational lensing. The key point is the reconstruction of the
fields $f_0(\te)$ and $f_1(\te)$.


For a circular source contour, a radial line of direction $\te$ intersects
the arc contours at two points, $r_i=\re+x_i$ and $r_o=\re+x_o$ (the inner part
and
the outer part). Now, we will use Alard Eq. 12

\beq
x = \frac{1}{\kappa_2}\left[ \overline{f}_{1}(\theta) \pm \sqrt{R_0^2 - \left(
\frac{1}{\re}\frac{\partial \overline{f}_0(\theta)}{\partial \theta} \right)^2}
\right]. \;\;\;
\eeq

And the separate two solutions for the inner and outer edges of the arc:


\bea
x_i = \frac{1}{\kappa_2}\left[ \overline{f}_{1}(\theta) - \sqrt{R_0^2 -%
\left( \frac{1}{\re}\frac{\partial \overline{f}_0(\theta)}{\partial \theta}
\right)^2} \right]. \;\;\;  \\
x_o = \frac{1}{\kappa_2}\left[ \overline{f}_{1}(\theta) + \sqrt{R_0^2 - %
\left( \frac{1}{\re}\frac{\partial \overline{f}_0(\theta)}{\partial \theta}
\right)^2} \right]. \;\;\;
\eea


With these, clearly

[There is a problem here, dealing with the definition of $r_{i,o}$ vs. $x_{i,o}$
-MSSG, Dec 6]
\beq
x_o + x_i  = {2 \over \kappa_2} \fbar -2\re
%= r_o+r_i - 2\re  ??
\eeq

And solve for $\fbar$:


\beq
\fbar = {\kappa_2 \over 2} (x_o+x_i) -2\kappa_2 \re
\eeq

which is exactly Alard eq. 29a, with his additional constant ($C=-\kt\re$).

Now take

\beq
x_o - x_i = {1 \over \kappa_2} \left(2 \sqrt{R_0^2 - {\left( {1 \over \re} \dfdt
\right)}^2 }\right)
\eeq

And solve for $\dfdt$ (few straight steps of algebra here):

\beq
\dfdt = \re \sqrt{R_0^2 - {\kappa_2^2 \over 4} (x_o-x_i)^2 }
\eeq

which is our form of Alard eq. 29b.

\section{Errors on arcs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Marcos

Recall that $\phi=\phi_0+\eps\psi$ and expand only $\psi$:

\beq
\phi=\phi_0+\eps\sum_{n=0}^{\infty}f_n(\theta)(r-\re)^n
\eeq

Differentiating we obtain

\bea
\frac{\partial \phi}{\partial r
}&=&\phi_0^\prime+\eps\sum_{n=1}^{\infty}f_n(\theta)n(r-\re)^{n-1} \\
\frac{\partial \phi}{\partial \theta}&=&\eps\sum_{n=0}^{\infty} \frac{\partial
f_n}{\partial \theta}(r-\re)^n
\eea

Evaluating at the Einstein radius $r=r_{\mathrm{E}}$, we have

\bea
\frac{\partial \phi}{\partial r }&=&\phi_0^\prime+f_1(\theta) \\
\frac{\partial \phi}{\partial \theta}&=&\eps \frac{\partial f_0}{\partial
\theta}
\eea

On the other hand, evaluating Eqs. 19 in Alard at $r=\re$, and using Eq. 16 in
Alard $\phi_0^\prime=1+2C_2(r-r_{\mathrm{E}}+...$

\bea
\frac{\prtl \phi}{\prtl r}&=& \phi_0^\prime -%
  \eps g(\te)\left[\phi_0^\prime+ \phi_0^{\prime
\prime}\right]=\phi_0^\prime-\eps g(\te)(1+C_2)\\
\frac{\prtl \phi}{\prtl \te}&=&-\eps\phi_0^\prime \frac{dg(\te)}{d\te}
\eea

Comparing these equations, we have a relation between the $f_n(\te)$ and
$g(\te)$ functions:

\bea
f_1&=&-(1+2C_2)g \\
\frac{df_0}{d\theta}&=&-\frac{dg}{d\theta}
\eea

Eq. (30) in Alard (to be derived later) is

\beq
dr=\frac{1}{\kappa_2}\left[ f_1+\frac{d^2f_0}{d\theta^2} \right]
\eeq

and in this case we have

\beq
dr=\frac{1}{\kappa_2}\left[ -(1+2C_2)g+\frac{d^2g}{d\theta^2} \right]
\eeq

Not sure what the effective parameter $dr_c$  in Eq 22 is and how to get it.
Assuming it's correct, i.e.
\beq
dr_c\sim -\frac{d^2g}{d\te^2}-2g
\eeq
we have that for e.g. the NFW profile with ellipticity (as in Eq. 28 of Alard)

\bea
\phi_0(q)&=&\frac{1}{2}\log^2\left(\frac{q}{2}\right)-2\arctan^2\left(\sqrt{
\frac{1-q}{1+q}}\right) \\
q&=&u_0r\sqrt{1-\eta\cos(\theta)}\approx u_0 r
\left[1-\frac{\eta}{2}\cos(2\theta)\right]
\eea

So in this case we have (notice $\eta/2$ plays the role of $\eps$ here, so only
expect expansion to work
for small ellipticities)

\bea
g(\te)&=&\frac{\eta}{2}\cos(2\theta) \\
\frac{d^2g(\te)}{d\te^2}&=&-2\eta\cos(\theta)=-4g
\eea

so that $dr_c=\eta\cos(\theta)$. Not sure if this is true for any elliptical
potential or if it's specific to NFW.
In any case the deviation is maximum for $\te=0,\pi$

If the Taylor expansion converges, truncating it at some order has a maximum
error given by the next order
term. In this case the maximum error due to the non-linearity of the gradient of
the potential is

\beq
D=3C_3\max[dr_c^2]=3C_3\eta^2
\eeq

Notice it increases with the ellipticity squared. For a general potential of the
form

\beq
\phi=\frac{1}{\alpha}r^{\alpha[1+\beta(r-1)]}
\eeq

we have

\beq
C_3=\frac{d^3\phi}{dr^3}|_{r=1}=-\frac{(\alpha-1)}{6}+\frac{\beta}{2}
\eeq

and $D^2$ follows.




